# diskAlert介绍



## 简介



​		`diskAlert`是远程查询服务器磁盘信息的工具，可实时查看并警报目的服务器的磁盘空间信息，可多服务器查询。目前该工具分为单机版（本地弹窗警报模式）与联机版（即邮件警报模式），目前支持查询`Linux`系统与`Aix`系统。



## 功能概要

1. 单机版（本地弹窗警报模式）：

   在`config.ini`配置文件中开启，根据`os_info.csv`文件中设定的服务器信息，远程查询服务器磁盘空间，并按设定的`阈值`判断后，以本地windows系统弹窗的形式反馈。

2. 联机版（即邮件警报模式）：

   在`config.ini`配置文件中开启，根据`os_info.csv`文件中设定的服务器信息，远程查询服务器磁盘空间，并按设定的`阈值`判断后，以`Outlook`邮件的形式反馈（可指定多个收件人及抄送）。

3. 定时任务：

   在`config.ini`配置文件中开启，配置完毕后开启定时任务策略，根据策略规则执行`diskAlert`脚本。**需要注意的是：**

   - 定时任务执行过程中不可关闭脚本，否则任务终止；
   - `如使用定时任务功能，强烈建议使用联机版（即邮件版）`；如使用单机版，每次根据定时任务策略执行`diskAlert`脚本后需要手动点击确定，否则该脚本线程不会释放，执行次数增多后会引起本地windows系统宕机！



## 版本



| 版本 | 更新日期   | 负责人 | 说明                                                         |
| ---- | ---------- | ------ | ------------------------------------------------------------ |
| v1.0 | 2020-07-18 | 路宋麟 | 初版，如需定时执行，可使用windows自带的任务计划程序；<br />或命令行使用schtasks添加任务计划。 |
| v1.1 | 2020-07-20 | 路宋麟 | 更新内容如下：<br />新增定时任务功能；<br />修改邮件版中发送邮件的内容及格式。 |



# 说明文档



## 文件说明

​    

​		解压`diskAlert_v1.1.zip`文件，`diskAlert_v1.1`文件夹下的`source.zip`为工具源码，`diskAlert`文件夹下为脚本工具。

​    `diskAlert`文件夹下的文件说明：

| 文件          | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| diskAlert.exe | 执行脚本，可双击执行或CMD命令行执行                          |
| config.ini    | 配置文件，脚本根据配置文件中配置的内容执行对应功能           |
| os_info.csv   | 需要远程查询磁盘工具的服务器信息，无上限数量                 |
| all.log       | 执行日志文件，执行脚本后生成，可在配置文件中配置日志级别，每日自动备份，亦可删除 |



## 使用说明



​		需要操作的文件为`config.ini`配置文件及`os_info.csv服务器信息文件`，需要注意的是，配置上述两份文件时，`切记勿直接双击打开修改！`

​		默认文件格式均为`utf-8`的格式，如直接双击打开修改后再保存，格式将变更为`utf-8-BOM`格式，此时再执行`diskAlert`脚本会报错！！！

​		建议使用`notepad++`或`UE`文本编辑器打开后修改！



### config.ini文件		



​		配置文件`config.ini`的内容如下所示：

![image-20200720140334568](C:\Users\luson\AppData\Roaming\Typora\typora-user-images\image-20200720140334568.png)

​		

​		说明如下：

| 域       | 字段           | 说明                                                         | 备注                                                         |
| -------- | -------------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| 基础配置 | 阈值           | 磁盘分区的使用率的阈值（即临界值）；<br />如超过该值则会对应反馈。 | 该值需为正整数                                               |
| 单机版   | 是否开启       | 单机版警报模式开关                                           | 开启可填：1 或 是<br />关闭可填：0 或 否 或 不填             |
| 邮件版   | 是否开启       | 邮件版（即联机版）警报模式开关                               | 开启可填：1 或 是<br />关闭可填：0 或 否 或 不填             |
| 邮件版   | 项目名         | 自定义的项目名称                                             | 发送的邮件标题中展示自定义的项目名称                         |
| 邮件版   | 邮箱类型       | 该处填写发送邮件的邮箱类型即可                               | 目前仅支持outlook邮箱；<br />故填写 outlook 或 Outlook 皆可  |
| 邮件版   | 收件人         | 收件人邮箱地址，如存在多个地址，可用分号间隔                 | 目前仅支持outlook邮箱；<br />例：test1@dev.com;test2@dev.com |
| 邮件版   | 抄送           | 抄送人邮箱地址，如存在多个地址，可用分号间隔                 | 目前仅支持outlook邮箱；<br />例：test3@dev.com;test4@dev.com |
| 定时任务 | 是否开启       | 定时任务功能开关                                             | 开启可填：1 或 是<br />关闭可填：0 或 否 或 不填             |
| 定时任务 | 间隔时间类型   | 即定时任务执行的间隔时间单位                                 | 可填如下单位：<br />seconds<br />minutes<br />hours<br />days<br />weeks |
| 定时任务 | 间隔时间整型值 | 即定时任务执行的间隔时间值                                   | 如字段名所示，该值只可填写正整数                             |
| 定时任务 | 启动时间       | 即定时任务执行的开始时间                                     | 该字段为空时停止时间字段亦必须为空，不填写即默认不设置启停时间<br />如设置则格式为：%Y-%m-%d %H%M%S |
| 定时任务 | 停止时间       | 即定时任务执行的结束时间                                     | 该字段为空时启动时间字段亦必须为空，不填写即默认不设置启停时间<br />如设置则格式为：%Y-%m-%d %H%M%S |
| 日志     | 日志级别       | 执行日志级别，可选：debug、info、error                       | 日志级别大小写输入均可；<br />例：debug或DEBUG；<br />如无需输出任何日志（包括报错日志）可输入warning或WARNING |



### os_info.csv文件

​		服务器信息文件`os_info.csv`的内容如下所示：

![image-20200720140121455](C:\Users\luson\AppData\Roaming\Typora\typora-user-images\image-20200720140121455.png)



​		说明如下：

| 字段        | 说明                   | 备注                                                         |
| ----------- | ---------------------- | ------------------------------------------------------------ |
| os_type     | 系统类型               | 目前支持Linux及Aix服务器；<br />故该字段可填：<br /> Linux 或 linux<br />Aix 或 aix |
| server_kind | 服务器类型             | 即服务器种类，例：容器宿主机、应用服务器，MySQL数据库等      |
| ip          | 服务器IP地址           | 例：10.135.12.11                                             |
| port        | 远程SSH端口            | 该端口为SSH连接专用端口，填写22即可                          |
| username    | 登录服务器的用户名     | /                                                            |
| passwd      | 对应登录用户的密码     | /                                                            |
| filesystem  | 指定查询的磁盘分区名称 | 文件系统分区名，如不填则默认查询服务器上所有磁盘分区空间信息；<br />如填写该字段，则只查询该磁盘分区空间信息，示例为：/dev/vda1 |



# 更新日志



| 更新日期   | 更新内容                                                     | 备注           |
| ---------- | ------------------------------------------------------------ | -------------- |
| 2020-07-18 | 初版，如需定时执行，可使用windows自带的任务计划程序；<br />或命令行使用schtasks添加任务计划。 | 初版v1.0发布   |
| 2020-07-20 | 1，经验证发现，初版添加至windows自带的任务计划程序，任务计划程序（taskeng.exe）调用该脚本执行报错；<br />经排查发现，windows默认编码格式为GB2312，该脚本默认编码格式为utf-8，用户手动操作脚本时无问题，但使用任务计划程序调用脚本时，由于编码格式不匹配导致脚本报错无法正常执行；<br />故新增定时任务功能，定时任务执行过程中不可关闭脚本，否则任务终止；<br />如使用定时任务功能，强烈建议使用联机版（即邮件版）。<br />2，修改邮件版中发送邮件的内容及格式。 | 版本更新为v1.1 |

