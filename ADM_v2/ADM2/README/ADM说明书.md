# ADM介绍



## 简介

​		

​		`ADM`即自动部署监控工具（`Automatic deployment monitoring`），该工具适用于`SPDB`的定制化监控脚本（`minoconda2`、`gather`、`amon`），将配置信息于`server_info.csv`中配置完毕后，远程一键部署启动，附带重启监控功能。



## 功能概要



​		需将监控脚本参数配置完毕后，于windows系统上将监控脚本打包，并将需要部署的信息配置于`server_info.csv`中，双击`ADM2.exe`或于CMD中运行即可。

​		目前仅支持以下三类脚本：

1. `minoconda2`（即`pstat_v1.0.4`）
2. `gather`
3. `amon`（即`amon_aix`）



## 版本



| 版本   | 完成日期   | 负责人 | 状态                                                         |
| ------ | ---------- | ------ | ------------------------------------------------------------ |
| v1.0   | 2020-06-25 | 路宋麟 | 初版                                                         |
| v2.0   | 2020-12-07 | 路宋麟 | 1，优化实现逻辑，简化使用时操作；<br />2，新增远程更新功能   |
| v2.0.1 | 2021-01-07 | 路宋麟 | 1，调整压缩后上传的监控脚本为tar包格式；<br />2，新增远程停止监控、远程删除监控功能 |



# 说明文档



## 文件说明

​	

​		解压`ADM_v2.zip`文件，`ADM_v2\ADM2`文件夹下得`source.zip`为工具源码，`ADM2`文件夹下为脚本及配置文件。

​		`ADM_v2`目录下得文件说明如下：

| 目录/文件       | 说明                                                      |
| --------------- | --------------------------------------------------------- |
| ADM2            | 执行脚本及配置文件的父目录                                |
| backup          | 远程更新时备份本地server_info.csv的目录（无需配置或操作） |
| autoUpgrade.exe | 远程更新可执行文件（需要更新时点击即可）                  |
| update.ini      | 远程更新的配置文件（使用者一般无需操作）                  |

​		`ADM2`目录下得文件说明如下：

| 目录/文件       | 说明                                                         |
| --------------- | ------------------------------------------------------------ |
| README          | 说明文档                                                     |
| ADM2.exe        | 可执行文件，可双击执行或CMD命令行执行                        |
| server_info.csv | 配置文件，ADM.exe根据该文件得配置内容自动化部署或重启远程监控 |
| source.zip      | 源码压缩包                                                   |



## 使用说明



​		需要配置的`server_info.csv`内容，路宋麟：

| 标题字段    | 说明                                 | 备注                                                         |
| ----------- | ------------------------------------ | ------------------------------------------------------------ |
| mon_type    | 监控脚本类型                         | 目前仅支持miniconda2(或pstat)、gather、amon三种监控脚本      |
| ip          | 需要部署监控的服务器地址             | /                                                            |
| port        | 需要部署监控的服务器连接端口         | SSH连接默认为端口为22，填写22即可                            |
| username    | 需要部署监控的服务器用户名           | /                                                            |
| passwd      | 需要部署监控的服务器用户密码         | /                                                            |
| local_path  | 本地配置好并压缩后的脚本文件绝对路径 | 1，需要事先配置好可监控的脚本中的配置参数，否则后续自动化上传后执行报错；<br />2，miniconda2、gather及amon脚本需打包成tar文件<br />3，路径需要带上上传的压缩文件名，格式如上图local_path字段所示 |
| remote_path | 远程上传的目的路径                   | 路径需要带上上传的压缩文件名，格式如上图remote_path字段所示  |
| start_path  | 执行启动监控命令的目录路径           | 格式如上图所示start_path字段所示                             |
| server_kind | 监控的服务器类型                     | 自定义选项，如：监控的为应用可配置为app，监控容器可配置为docker等 |



## 补充说明



1. 执行脚本后，请按照命令行界面提示的参数输入对应序号，说明如下：


- 序号1即远程部署监控，可多台服务器批量远程部署；
- 序号2即远程重启监控，可多台服务器远程一键重启；
- 序号3即远程停止监控，可多台服务器远程一键停止；
- 序号4即远程停止监控并删除监控脚本，可多台服务器远程一键删除；
- 序号0即退出工具；

2. miniconda2（即pstat）中，配置`miniconda2\pstat_v1.0.4\conf\monitor.conf`时，请将`server`配置为`custom`，否则工具报错（自定义的`server_kind`配置项不生效）；
3. gather中，配置`gather\bin\gather`文件时，请将`hostname`配置为`custom`、`localhost`配置为`localhost`，否则工具报错；
4. amon中，无特殊注意参数，按实际情况配置即可；
5. 所有本工具支持的监控脚本中，本地仅需配置一份需上传的监控脚本即可，需要注意的是，所有的配置项目均需配置全量参数（例如：需监控2台应用服务器中的java进程，一台关键字为java1，另一台中关键字为java2，请在监控脚本中将两关键字均配置，容器关键字同理）



# 更新日志



| 更新日期   | 更新内容                                                     | 备注      |
| ---------- | ------------------------------------------------------------ | --------- |
| 2020-06-25 | 发布ADM_v1.0版本                                             | 初版      |
| 2020-12-07 | 1，优化实现逻辑，简化使用时操作；<br />2，新增远程更新功能   | 2.0版本   |
| 2021-01-07 | 1，调整压缩后上传的监控脚本为tar包格式；<br />2，新增远程停止监控、远程删除监控功能 | 2.0.1版本 |

